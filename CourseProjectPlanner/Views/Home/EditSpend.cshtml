@model CourseProjectPlanner.Models.Spend

@{
	ViewData["Title"] = "EditSpend";
}

@{
	ViewData["Title"] = "AddSpend";
	List<Category> categoriesList = ViewBag.CategoriesList;
	List<string> imageNameCategoriesList = new List<string>();

	string categoryName = categoriesList.Where(c => c.CategoryId == Model.CategoryId).Select(c => c.Name).FirstOrDefault();
	string categoryImage = categoriesList.Where(c => c.CategoryId == Model.CategoryId).Select(c => c.ImageName).FirstOrDefault();
	int userId = ViewBag.UserId;
}

@{
	foreach (var category in categoriesList)
	{
		imageNameCategoriesList.Add(category.ImageName);
	}
}

<link rel="stylesheet" href="~/css/modal.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/item.css" asp-append-version="true" />



<div id="myModal" class="modal">

	<!-- Modal content -->
	<div class="modal-content center-element">
		<div>
			<span class="close" id="closeButton">&times;</span>
			<h5 class="text-center">Деталі про витрату</h5>
		</div>
		<div class="d-flex">
			<div class="card col-md-3 col-10 mt-5">
				<img class='mx-auto img-thumbnail' id="categoryImage"
					 src="/images/@categoryImage"
					 width="100px" />
				<div class="card-body text-center mx-auto">
					<div class='cvp'>
						<h5 class="card-title font-weight-bold" id="categoryName">@categoryName</h5>

						<p class="card-text" id="priceOutput">₴@Model.Price</p>
						<p>
							@DateOnly.FromDateTime(DateTime.Now).ToString("yyyy/MM/dd")
						</p>
					</div>
				</div>
			</div>



			<form asp-action="EditSpend">
				<div asp-validation-summary="ModelOnly" class="text-danger"></div>
				<input type="hidden" asp-for="SpendId" />
				<div>
					<label asp-for="Price" class="control-label">Ціна</label>
					<input asp-for="Price" class="form-control" id="priceInput" />
					<span asp-validation-for="Price" class="text-danger"></span>
					<p></p>
					<label asp-for="CategoryId" class="control-label"></label>
					<select asp-for="CategoryId" class="form-control" id="categoryInput">
						@foreach (var category in categoriesList)
						{
							<option value="@category.CategoryId">@category.Name</option>
						}
					</select>

					<span asp-validation-for="CategoryId" class="text-danger"></span>
					<p></p>
					<label asp-for="Description" class="control-label"></label>
					<textarea asp-for="Description" id="descriptionInput" class="form-control"></textarea>
					<span asp-validation-for="Description" class="text-danger"></span>

				</div>
				<p class="text-center">
					<input type="submit" value="Зберегти зміни" class=" green-button" />
				</p>
				<p class="text-center">
					<a type="button" asp-controller="Home" asp-action="RemoveSpend" class="red-button">Видалити витрату</a>
				</p>
				<div style="display: none">
				</div>

				<input asp-for="UserId" class="form-control" value=@userId style="display:none" />
				<span asp-validation-for="UserId" class="text-danger"></span>

				<input asp-for="SpendDate" class="form-control" style="display: none" value="@DateOnly.FromDateTime(DateTime.Now).ToString("yyyy-MM-dd")" />
				<span asp-validation-for="SpendDate" class="text-danger"></span>

			</form>
		</div>
	</div>



</div>


@section Scripts {
	@{
		await Html.RenderPartialAsync("_ValidationScriptsPartial");
	}
}


<script>
	let modal = document.getElementById("myModal");


	let close = document.getElementById("closeButton");

	let categoryInput = document.getElementById("categoryInput");
	let categoryName = document.getElementById("categoryName");
	let categoryImage = document.getElementById("categoryImage");

	let imageNameOfCategoriesList = @Html.Raw(Json.Serialize(imageNameCategoriesList));


	let priceInput = document.getElementById("priceInput");
	let priceOutput = document.getElementById("priceOutput");

	modal.style.display = "block";


	priceInput.oninput = function () {
		priceOutput.textContent = `₴${priceInput.value}`;
	};

	categoryInput.onchange = function () {
		let selectedCategory = categoryInput.selectedIndex;
		let imgFile = imageNameOfCategoriesList[selectedCategory];

		categoryImage.src = `/images/${imgFile}`;
		categoryName.textContent = categoryInput.options[categoryInput.selectedIndex].textContent;

	};

	close.onclick = function () {
		window.history.go(-1);

	}

</script>